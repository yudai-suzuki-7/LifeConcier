<div class="row mx-3" style="margin-top: 26px;">
    <h1>ToDo List
    </h1>
</div>
<div class="row mx-3">
    <%= render 'layouts/error', error: @todo %>
    <div class="todo-add-form">
        <%= form_for(@todo,url: todos_path) do |form| %>
        <span class="todo-text">
            <%= form.text_field :todo_text, style:"height:30px; width:300px;" %>
        </span>
        <span class="submit">
            <%= form.submit('追加',class: "btn btn-secondary btn-sm") %>
        </span>
        <% end %>
    </div>
    <table class="todo_list table table-striped mt-3">
        <thead>
            <tr>
                <th class="head-text text-center">Check</th>
                <th class="head-text text-center">Task</th>
                <th class="head-text text-center">編集</th>
                <th class="head-text text-center">消去</th>
            </tr>
        </thead>
        <tbody id="todo_list">
            <% @todos.each do |todo| %>
            <%= render :partial => "todo_item", :locals => { todo: todo } %>
            <% end %>
        </tbody>
    </table>
</div>

<script>
$(function() {
    $('#todo_list').sortable({
        update: function(e, ui) {
            let item = ui.item;
            let item_data = item.data();
            let params = { _method: 'put' };
            params[item_data.modelName] = { row_order_position: item.index() }
            $.ajax({
                type: 'POST',
                url: item_data.updateUrl,
                dataType: 'json',
                data: params
            });
        },
        stop: function(e, ui) {
            ui.item.children('td').not('.item__status').effect('highlight', { color: "#FFFFCC" }, 500)
        }
    });
});
</script>